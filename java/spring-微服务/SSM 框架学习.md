# Spring

## 框架概念
![[Pasted image 20221113235459.png]]


### Ioc 

Ioc—Inversion of Control，即“控制反转”.

Ioc意味着将你设计好的对象交给容器控制，而不是传统的在你的对象内部直接控制。
- **谁控制谁，控制什么**：传统Java SE程序设计，我们直接在对象内部通过new进行创建对象，是程序主动去创建依赖对象；而IoC是有专门一个容器来创建这些对象，即由Ioc容器来控制对象的创建；谁控制谁？当然是IoC 容器控制了对象；控制什么？那就是主要控制了外部资源获取（不只是对象包括比如文件等）。
- **为何是反转，哪些方面反转了**：有反转就有正转，传统应用程序是由我们自己在对象中主动控制去直接获取依赖对象，也就是正转；而反转则是由容器来帮忙创建及注入依赖对象；为何是反转？因为由容器帮我们查找及注入依赖对象，对象只是被动的接受依赖对象，所以是反转；哪些方面反转了？依赖对象的获取被反转了。



没有 Ioc 之前的代码是直接 new,自己显示的去定义自己要使用的类。 现在是把 new 这个操作移交出去给 spring 的 Ioc 容器去 new, 这个 new 的过程你看不见，想用的时候直接从 spring 获取。隐藏了内部的 new 操作，实现了代码的解耦。
Ioc 容器负责对象的创建、初始化等一系列操作，被创建或者被管理的对象被称为 **Bean**



### Bean

#### Bean 的实例化

**构造函数**


**静态工厂**


**实例工厂与 factory bean**




#### Bean 的生命周期
1. 初始化容器
	1. 创建对象（内存分配）
	2. 执行构造方法
	3. 执行属性注入（set 操作）
	4. 执行 bean 初始化方法
2. 使用 bean 执行业务操作
3. 关闭/销毁容器

**Bean 的销毁时机**
容器关闭前会触发 bean 的销毁
关闭容器的方式
- 手工关闭容器
	- ConfigurableApplicationContext 的 close 方法。
- 注册关闭钩子
	- ConfigurableApplicationContext 接口的 registerShutdownHook



### DI

DI—Dependency Injection，即“依赖注入”. 在容器中建立 bean 和 bean 之间的依赖关系的过程，称为**依赖注入**。

组件之间依赖关系由容器在运行期决定，形象的说，即由容器动态的将某个依赖关系注入到组件之中。依赖注入的目的并非为软件系统带来更多功能，而是为了提升组件重用的频率，并为系统搭建一个灵活、可扩展的平台。通过依赖注入机制，我们只需要通过简单的配置，而无需任何代码就可指定目标需要的资源，完成自身的业务逻辑，而不需要关心具体的资源来自何处，由谁实现。


向一个类当中传递数据有两种方法：
1. setter 注入
	1. 简单类型： 在类的中添加 setter 方法，然后直接在 bean 的配置中定义对应值的value
	2. 引用类型：在类中添加 setter 方法，然后在 bean 中通过 ref 的方式去调这个 setter
2. 构造函数注入
	1. 在构造函数中定义构造方式即可

依赖注入方式选择：
1. 强制依赖使用构造函数，使用setter 注入有概率不进行注入导致 null 对象出现
2. 可选依赖使用 setter 注入，灵活
3. spring 倡导使用构造器，第三方框架内不大多数采用构造器注入的方式进行数据初始化，相对严谨
4. 自己开发的模块推荐使用setter 注入




##### 依赖自动装配

Ioc 容器根据 Bean 依赖的资源在容器中查找并注入到 bean 中的过程叫做自动装配。

自动装配的方式：
1. 按类型
2. 按名称
3. 按构造方法
4. 不启用自动装配




自动装配的特征
- 只能注入引用类型，不能注入简单类型
- 按类型装配（byType）时，必须保证配置中相同类型的 bean 唯一
- 按名称装配时，必须保证容器中存在与被注入的类中变量名一致。这样会导致与变量名存在耦合，不推荐使用。
- 自动装配优先级低于setter 和构造函数




![[Pasted image 20221118020603.png]]
